{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/banner-schedule-slack/banner-schedule-web/src/app/admin/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport * as XLSX from \"xlsx\";\r\n\r\nconst API_BASE = \"https://nhbanner-slack.onrender.com\";\r\n\r\nconst BANNER_TYPES = {\r\n  home: \"üè† ÌôàÎ∞∞ÎÑà\",\r\n  floating: \"üìå ÌîåÎ°úÌåÖÎ∞∞ÎÑà\",\r\n  interest: \"‚≠ê Í¥ÄÏã¨Í∑∏Î£πÌÉ≠Î∞∞ÎÑà\",\r\n};\r\n\r\nfunction getCurrentMonthYYYYMM() {\r\n  const d = new Date();\r\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n}\r\n\r\nfunction safeString(v) {\r\n  return typeof v === \"string\" ? v : v == null ? \"\" : String(v);\r\n}\r\n\r\nexport default function AdminPage() {\r\n  const [month, setMonth] = useState(getCurrentMonthYYYYMM());\r\n  const [activeType, setActiveType] = useState(\"home\");\r\n  const [allData, setAllData] = useState({\r\n    home: [],\r\n    floating: [],\r\n    interest: [],\r\n  });\r\n  const [loadError, setLoadError] = useState(\"\");\r\n  const [editItem, setEditItem] = useState(null);\r\n\r\n  /* ===============================\r\n   * Îç∞Ïù¥ÌÑ∞ Î°úÎìú\r\n   * =============================== */\r\n  useEffect(() => {\r\n    async function run() {\r\n      try {\r\n        setLoadError(\"\");\r\n\r\n        const results = {};\r\n\r\n        for (const type of Object.keys(BANNER_TYPES)) {\r\n          const res = await fetch(\r\n            `${API_BASE}/api/banner/${type}`,\r\n            { cache: \"no-store\" }\r\n          );\r\n\r\n          if (!res.ok) throw new Error(`${type} API Ïã§Ìå®`);\r\n\r\n          results[type] = await res.json();\r\n        }\r\n\r\n        setAllData(results);\r\n      } catch (e) {\r\n        setLoadError(e?.message || \"Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®\");\r\n      }\r\n    }\r\n\r\n    run();\r\n  }, []);\r\n\r\n  /* ===============================\r\n   * Ïõî ÌïÑÌÑ∞\r\n   * =============================== */\r\n  const filtered = useMemo(() => {\r\n    const raw = allData[activeType] || [];\r\n\r\n    return raw\r\n      .filter((item) =>\r\n        safeString(item.startDate).startsWith(month)\r\n      )\r\n      .sort((a, b) =>\r\n        safeString(a.startDate).localeCompare(\r\n          safeString(b.startDate)\r\n        )\r\n      )\r\n      .map((item, idx) => ({\r\n        no: idx + 1,\r\n        ...item,\r\n      }));\r\n  }, [allData, activeType, month]);\r\n\r\n  /* ===============================\r\n   * ÏàòÏ†ï\r\n   * =============================== */\r\n  function handleEdit(item) {\r\n    setEditItem({ ...item });\r\n  }\r\n\r\n  async function saveEdit() {\r\n    await fetch(`${API_BASE}/api/admin/update`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        type: activeType,\r\n        id: editItem.id,\r\n        updatedData: editItem,\r\n      }),\r\n    });\r\n\r\n    location.reload();\r\n  }\r\n\r\n  /* ===============================\r\n   * ÏÇ≠Ï†ú\r\n   * =============================== */\r\n  async function handleDelete(item) {\r\n    if (!confirm(\"Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\")) return;\r\n\r\n    await fetch(`${API_BASE}/api/admin/delete`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        type: activeType,\r\n        id: item.id,\r\n      }),\r\n    });\r\n\r\n    location.reload();\r\n  }\r\n\r\n  /* ===============================\r\n   * ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú\r\n   * =============================== */\r\n  function downloadExcel() {\r\n    const wb = XLSX.utils.book_new();\r\n\r\n    const rows = filtered.map((item) => ({\r\n      No: item.no,\r\n      EventCode: item.targetEventCode,\r\n      Î∞∞ÎÑàÍµ¨Î∂Ñ: item.bannerCategory,\r\n      Îß§Ï≤¥Ïú†Ìòï: item.mediaType,\r\n      Î∞∞ÎÑàÎ™Ö: item.banner,\r\n      Î∞∞ÎÑàÎÇ¥Ïö©: item.bannerContent,\r\n      ÎÖ∏Ï∂úÏãúÏûë: item.startDate,\r\n      ÎÖ∏Ï∂úÏ¢ÖÎ£å: item.endDate,\r\n      Î∞îÎ°úÍ∞ÄÍ∏∞ÏÜçÏÑ±: item.linkType,\r\n      ÎßÅÌÅ¨: item.linkUrl,\r\n      ÎßÅÌÅ¨Îç∞Ïù¥ÌÑ∞: item.linkData,\r\n      CreatedAt: item.createdAt,\r\n    }));\r\n\r\n    const ws = XLSX.utils.json_to_sheet(rows);\r\n    XLSX.utils.book_append_sheet(wb, ws, BANNER_TYPES[activeType]);\r\n    XLSX.writeFile(wb, `banner_admin_${month}.xlsx`);\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: 40, fontFamily: \"sans-serif\" }}>\r\n      <h1 style={{ fontSize: 26, marginBottom: 20 }}>\r\n        üõ† Î∞∞ÎÑà Í¥ÄÎ¶¨Ïûê ÌôîÎ©¥\r\n      </h1>\r\n\r\n      {/* ÌÉÄÏûÖ ÌÉ≠ */}\r\n      <div style={{ display: \"flex\", gap: 10, marginBottom: 20 }}>\r\n        {Object.entries(BANNER_TYPES).map(([type, label]) => (\r\n          <button\r\n            key={type}\r\n            onClick={() => setActiveType(type)}\r\n            style={{\r\n              padding: \"8px 14px\",\r\n              cursor: \"pointer\",\r\n              background:\r\n                activeType === type ? \"#222\" : \"#eee\",\r\n              color:\r\n                activeType === type ? \"#fff\" : \"#000\",\r\n              border: \"none\",\r\n              borderRadius: 6,\r\n            }}\r\n          >\r\n            {label}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Ïõî ÌïÑÌÑ∞ */}\r\n      <div style={{ display: \"flex\", gap: 12, marginBottom: 16 }}>\r\n        <input\r\n          type=\"month\"\r\n          value={month}\r\n          onChange={(e) => setMonth(e.target.value)}\r\n        />\r\n\r\n        <button onClick={downloadExcel}>\r\n          ‚¨á ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú\r\n        </button>\r\n\r\n        <span>({filtered.length}Í±¥)</span>\r\n      </div>\r\n\r\n      {loadError && (\r\n        <div style={{ color: \"red\" }}>‚ùå {loadError}</div>\r\n      )}\r\n\r\n      {/* ÌÖåÏù¥Î∏î */}\r\n      <table\r\n        border=\"1\"\r\n        cellPadding=\"8\"\r\n        style={{\r\n          borderCollapse: \"collapse\",\r\n          width: \"100%\",\r\n          textAlign: \"center\",\r\n        }}\r\n      >\r\n        <thead>\r\n          <tr>\r\n            <th>Í¥ÄÎ¶¨</th>\r\n            <th>No</th>\r\n            <th>EventCode</th>\r\n            <th>Î∞∞ÎÑàÍµ¨Î∂Ñ</th>\r\n            <th>Îß§Ï≤¥Ïú†Ìòï</th>\r\n            <th>Î∞∞ÎÑàÎ™Ö</th>\r\n            <th>Î∞∞ÎÑàÎÇ¥Ïö©</th>\r\n            <th>ÎÖ∏Ï∂úÏãúÏûë</th>\r\n            <th>ÎÖ∏Ï∂úÏ¢ÖÎ£å</th>\r\n            <th>Î∞îÎ°úÍ∞ÄÍ∏∞ÏÜçÏÑ±</th>\r\n            <th>ÎßÅÌÅ¨</th>\r\n            <th>ÎßÅÌÅ¨Îç∞Ïù¥ÌÑ∞</th>\r\n            <th>CreatedAt</th>\r\n          </tr>\r\n        </thead>\r\n\r\n        <tbody>\r\n          {filtered.length === 0 ? (\r\n            <tr>\r\n              <td colSpan=\"13\">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</td>\r\n            </tr>\r\n          ) : (\r\n            filtered.map((item) => (\r\n              <tr key={item.id}>\r\n                <td>\r\n                  <button onClick={() => handleEdit(item)}>ÏàòÏ†ï</button>\r\n                  <button\r\n                    onClick={() => handleDelete(item)}\r\n                    style={{ color: \"red\" }}\r\n                  >\r\n                    ÏÇ≠Ï†ú\r\n                  </button>\r\n                </td>\r\n                <td>{item.no}</td>\r\n                <td>{item.targetEventCode}</td>\r\n                <td>{item.bannerCategory}</td>\r\n                <td>{item.mediaType}</td>\r\n                <td>{item.banner}</td>\r\n                <td>{item.bannerContent}</td>\r\n                <td>{item.startDate}</td>\r\n                <td>{item.endDate}</td>\r\n                <td>{item.linkType}</td>\r\n                <td>{item.linkUrl}</td>\r\n                <td>{item.linkData}</td>\r\n                <td>{item.createdAt}</td>\r\n              </tr>\r\n            ))\r\n          )}\r\n        </tbody>\r\n      </table>\r\n\r\n      {/* ÏàòÏ†ï Î™®Îã¨ */}\r\n      {editItem && (\r\n        <div style={{\r\n          position: \"fixed\",\r\n          inset: 0,\r\n          background: \"rgba(0,0,0,0.4)\",\r\n          display: \"flex\",\r\n          justifyContent: \"center\",\r\n          alignItems: \"center\",\r\n        }}>\r\n          <div style={{\r\n            background: \"#fff\",\r\n            padding: 20,\r\n            width: 400,\r\n          }}>\r\n            <h3>Î∞∞ÎÑà ÏàòÏ†ï</h3>\r\n\r\n            <input\r\n              value={editItem.banner}\r\n              onChange={(e) =>\r\n                setEditItem({ ...editItem, banner: e.target.value })\r\n              }\r\n              style={{ width: \"100%\", marginBottom: 10 }}\r\n            />\r\n\r\n            <button onClick={saveEdit}>Ï†ÄÏû•</button>\r\n            <button onClick={() => setEditItem(null)}>\r\n              Ï∑®ÏÜå\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}